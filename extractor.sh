#!/bin/bash

FILE=$1
INDENTATION=$2
X=$3
Y=$4

tail -n +$X $FILE | head -n $((Y-X+1)) | sed 's/\r//g' | sed 's/^ *//g' | sed 's/#.*$//g' \
    | sed 's/\t/    /g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\"/\1/g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\"/\1@\2/g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\"/\1@\2@\3/g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\"/\1@\2@\3@\4/g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\"/\1@\2@\3@\4/g' \
    | sed 's/\"\([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\ \([^\"\ ][^\"\ ]*\)\"/\1@\2@\3@\4@\5/g' \
    | sed 's/  */ /g' \
    | sed 's/ /\n/g' \
    | sort | uniq \
    | sed -r '/^\s*$/d' \
    | sed 's/@/ /g' \
    | sed 's|\(.*\)|'"$INDENTATION"'<string>\1</string>|g' \
    | sort  > result.txt

xclip -sel clip < result.txt
